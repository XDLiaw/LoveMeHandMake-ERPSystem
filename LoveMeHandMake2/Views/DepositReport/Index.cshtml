@model LoveMeHandMake2.Models.ViewModels.DepositReportViewModel

@{
    ViewBag.Title = "会员点数销售表＆通讯录";
}

<h2>会员点数销售表＆通讯录</h2>


@using (Html.BeginForm("Index", "DepositReport", FormMethod.Post))
{
    <div class="container">
        <div class="col-md-3">
            @Html.DropDownList("SearchStoreID", (IEnumerable<SelectListItem>)ViewBag.StoreList, htmlAttributes: new { id = "SearchStoreID", @class = "form-control" })
        </div>
        <div class="col-md-3">
            @Html.EditorFor(model => model.SearchDateStart, new { htmlAttributes = new { id = "SearchDateStart", name = "SearchDateStart", @class = "form-control calendarBox", placeholder = "日期(起)" } })
        </div>
        <div class="col-md-3">
            @Html.EditorFor(model => model.SearchDateEnd, new { htmlAttributes = new { id = "SearchDateEnd", name = "SearchDateEnd", @class = "form-control calendarBox", placeholder = "日期(起)" } })
        </div>
        <div class="col-md-1">
            <input type="submit" value="搜寻" class="btn btn-default" />
        </div>
        <div class="col-md-2">
            <input type="button" value="产出Excel报表" class="btn btn-file" onclick="btnDownload();" />
        </div>
    </div>
}

<p />

<table class="table table-striped table-hover">
    <tr>
        <th>@Html.DisplayNameFor(model => model.DepositList.FirstOrDefault().DepositTime)</th>
        <th>@Html.DisplayNameFor(model => model.DepositList.FirstOrDefault().MemberName)</th>
        <th>@Html.DisplayNameFor(model => model.DepositList.FirstOrDefault().MemberBirthday)</th>
        <th>@Html.DisplayNameFor(model => model.DepositList.FirstOrDefault().MemberGender)</th>
        <th>@Html.DisplayNameFor(model => model.DepositList.FirstOrDefault().Point)</th>
        <th>@Html.DisplayNameFor(model => model.DepositList.FirstOrDefault().MemberCardID)</th>
        <th>@Html.DisplayNameFor(model => model.DepositList.FirstOrDefault().TeacherName)</th>
        <th>@Html.DisplayNameFor(model => model.DepositList.FirstOrDefault().MemberPhone)</th>
    </tr>
    @if (Model != null)
    {
        foreach (var item in Model.DepositList)
        {
            <tr>
                <td>@Html.DisplayFor(modelItem => item.DepositTime)</td>
                <td>@Html.DisplayFor(modelItem => item.MemberName)</td>
                <td>@Html.DisplayFor(modelItem => item.MemberBirthday)</td>
                <td>@(item.MemberGender == null ? "" : (item.MemberGender == true ? "男" : "女"))</td>
                <td>@Html.DisplayFor(modelItem => item.Point)</td>
                <td>@Html.DisplayFor(modelItem => item.MemberCardID)</td>                
                <td>@Html.DisplayFor(modelItem => item.TeacherName)</td>
                <td>@Html.DisplayFor(modelItem => item.MemberPhone)</td>
            </tr>
        }
    }
</table>
<p />
<p />
<h4>个人业绩销售小计</h4>
<table class="table table-striped table-hover">
    <tr>
        <th>@Html.DisplayNameFor(model => model.TeacherSalesPerformanceList.FirstOrDefault().TeacherName)</th>
        <th>@Html.DisplayNameFor(model => model.TeacherSalesPerformanceList.FirstOrDefault().Point)</th>
    </tr>
    @if (Model != null)
    {
        foreach (var item in Model.TeacherSalesPerformanceList)
        {
            <tr>
                <td>@Html.DisplayFor(modelItem => item.TeacherName)</td>
                <td>@Html.DisplayFor(modelItem => item.Point)</td>
            </tr>
        }
    }
</table>

@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")

    <script type="text/javascript">
        function btnDownload() {
            try {
                var storeID = $("#SearchStoreID").val();
                var start = $("#SearchDateStart").val();
                var end = $("#SearchDateEnd").val();
                window.location.href = "/DepositReport/DownloadReport?SearchStoreID=" + storeID + "&SearchDateStart=" + start + "&SearchDateEnd=" + end;
                return true;
            }
            catch(e) {
                return false;
            }
        }
    </script>
}